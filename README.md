# v2 is under development. Don't use this!!!

## Todo
- `/kdstatus refresh-cache`の実装

## 開発上の注意
- パッチバージョンで破壊的変更を行わないでください。
- 適切なバージョニングを心がけてください。
- APIの仕様変更をする場合\
すぐに、APIからメソッドを消すのではなく、`@Deprecated`を2つ以上先のマイナーバージョンに向けて付けること

## APIの返り値について
- 成功時には、その値が返ってきます
- 失敗時には、`null`を返します。

## APIの仕様
- このAPIは読み取り専用であり、書き込み等は行えない。
- APIの使用時には、毎回`KDStatusReloaded.getAPI()`を行うことが推奨される。\
(プラグインの再読み込み等により、内部の値が変化している可能性があるため)
- APIは、同じマイナーバージョン内では破壊的変更が行われることはない。

## 運用上の注意
- APIのキャッシュ等は時間ベースではなく、変化したタイミングで行なっている。 \
そのため、データベースを直接書き換える等の操作が行われた場合には手動で`/kdstatus refresh-cache`を行う必要性がある。
- データベースへの接続のヘルスチェックはconfig内で設定された間隔で行います\
状況に応じて、適切な間隔に設定してください。

## データベース切り替え
このKDStatusReloadedでは、複数のデータベースがサポートされており、切り替えることができます。\
切り替えコマンドは、`/kdstatus switch-db <db-alias>`となっています。\
db-aliasは、

| データベース名 | db-alias |
|---------|----------|
| MySQL   | mysql    |
| MariaDB | mariadb  |
| SQLite3 | sqlite3  |
となっています。

## 緊急時
- メインデータベースへ接続が不可能になった場合には、sqlite3を用いて、ローカルに自動的に保存されます。
- もしも、APIも何もかも死んだ時には、`/kdstatus force-reload`をかけることでこれらのタスクが走ります。
  - データベースへ再接続
  - キャッシュの再取得
  - APIのリフレッシュ
